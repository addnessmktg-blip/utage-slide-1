<script>
(function() {
  // ===== 編集画面かどうか判定 =====
  var isEditMode = (
    window.location.href.indexOf('/edit') !== -1 ||
    window.location.href.indexOf('/admin') !== -1 ||
    window.location.href.indexOf('preview=') !== -1 ||
    document.querySelector('.editor-container') ||
    document.querySelector('#editor') ||
    document.querySelector('[data-edit-mode]') ||
    window.parent !== window
  );

  if (isEditMode) {
    console.log('編集モード: フルスクリーン無効');
    return;
  }

  // ===== 公開ページ: フルスクリーン適用 =====
  var slide = document.getElementById('ai-yesman-slide');
  if (slide) {
    slide.classList.add('is-fullscreen');
  }

  document.body.style.margin = '0';
  document.body.style.padding = '0';
  document.body.style.overflow = 'hidden';

  // UTAGE要素を非表示
  var hideSelectors = [
    '.btn-toolbar', '#next_btn', 'nav[aria-label="breadcrumb"]',
    'h4.mb-4', 'header > nav', 'footer', '.sidebar', '#sidebar',
    '.col-3', '.col-md-3', '.col-lg-3'
  ];

  function hideElements() {
    hideSelectors.forEach(function(sel) {
      document.querySelectorAll(sel).forEach(function(el) {
        if (!el.closest('#ai-yesman-slide')) {
          el.style.display = 'none';
        }
      });
    });
  }

  hideElements();
  setInterval(hideElements, 500);

  // ===== 次のスライドにスクロール =====
  window.scrollToNext = function(currentSlide) {
    var nextSlide = document.getElementById('slide-' + (currentSlide + 1));
    if (nextSlide) {
      nextSlide.scrollIntoView({ behavior: 'smooth' });
    }
  };

  // ===== キーボード操作対応 =====
  document.addEventListener('keydown', function(e) {
    if (e.key === 'ArrowDown' || e.key === ' ' || e.key === 'Enter') {
      e.preventDefault();
      var sections = document.querySelectorAll('.slide-section');
      var currentSection = null;

      for (var i = 0; i < sections.length; i++) {
        var rect = sections[i].getBoundingClientRect();
        if (rect.top >= -100 && rect.top < window.innerHeight / 2) {
          currentSection = i;
          break;
        }
      }

      if (currentSection !== null && currentSection < sections.length - 1) {
        sections[currentSection + 1].scrollIntoView({ behavior: 'smooth' });
      }
    }

    if (e.key === 'ArrowUp') {
      e.preventDefault();
      var sections = document.querySelectorAll('.slide-section');
      var currentSection = null;

      for (var i = 0; i < sections.length; i++) {
        var rect = sections[i].getBoundingClientRect();
        if (rect.top >= -100 && rect.top < window.innerHeight / 2) {
          currentSection = i;
          break;
        }
      }

      if (currentSection !== null && currentSection > 0) {
        sections[currentSection - 1].scrollIntoView({ behavior: 'smooth' });
      }
    }
  });
})();
</script>
